<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIA Avatar Engine Pro - Test Loader</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #e0f7ff;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 {
            color: #00f3ff;
            margin-bottom: 20px;
            font-size: 24px;
            text-shadow: 0 0 20px rgba(0, 243, 255, 0.5);
        }

        .container {
            display: flex;
            gap: 30px;
            max-width: 1200px;
            width: 100%;
        }

        .canvas-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #lia-avatar {
            border-radius: 20px;
            box-shadow: 0 0 40px rgba(0, 243, 255, 0.2);
            background: linear-gradient(180deg, #1a1a2e 0%, #0a0a0a 100%);
            max-width: 100%;
        }

        .controls {
            flex: 0 0 350px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            backdrop-blur: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group h3 {
            color: #bc13fe;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input[type="file"] {
            display: none;
        }

        .upload-label {
            display: block;
            padding: 16px;
            background: linear-gradient(135deg, #00f3ff 0%, #bc13fe 100%);
            color: black;
            font-weight: bold;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .upload-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 243, 255, 0.4);
        }

        input[type="text"] {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: #e0f7ff;
            font-size: 14px;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #00f3ff;
        }

        button {
            width: 100%;
            padding: 14px;
            background: #00f3ff;
            color: black;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
        }

        button:hover {
            background: #33f5ff;
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button.secondary {
            background: rgba(188, 19, 254, 0.2);
            color: #bc13fe;
            border: 1px solid #bc13fe;
        }

        button.secondary:hover {
            background: rgba(188, 19, 254, 0.3);
        }

        .status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(0, 243, 255, 0.1);
            border-radius: 8px;
            font-size: 12px;
            margin-top: 10px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #666;
            transition: background 0.3s;
        }

        .status-dot.active {
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
        }

        .log-container {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            font-family: monospace;
            font-size: 11px;
        }

        .log-entry {
            padding: 4px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .emotion-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .emotion-btn {
            flex: 1;
            min-width: 80px;
            padding: 8px 12px;
            font-size: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: #e0f7ff;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .emotion-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: none;
        }

        .emotion-btn.active {
            background: #bc13fe;
            color: white;
            border-color: #bc13fe;
        }
    </style>
</head>

<body>
    <h1>üé≠ LIA Avatar Engine Pro</h1>

    <div class="container">
        <div class="canvas-container">
            <canvas id="lia-avatar" width="512" height="768"></canvas>

            <div class="status">
                <span class="status-dot" id="status-dot"></span>
                <span id="status-text">Aguardando imagem...</span>
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <h3>üì∑ Imagem Base</h3>
                <label class="upload-label" for="image-input">
                    Selecionar Imagem da LIA
                </label>
                <input type="file" id="image-input" accept="image/*">
            </div>

            <div class="control-group">
                <h3>üó£Ô∏è Teste de Fala</h3>
                <input type="text" id="speak-text" placeholder="Digite o texto para a LIA falar..."
                    value="Ol√°! Eu sou a LIA, sua assistente inteligente da Luminnus.">
                <button id="speak-btn" disabled>Falar</button>
                <button id="stop-btn" class="secondary" disabled>Parar</button>
            </div>

            <div class="control-group">
                <h3>üòä Express√µes</h3>
                <div class="emotion-buttons">
                    <button class="emotion-btn" data-emotion="neutral">Neutro</button>
                    <button class="emotion-btn" data-emotion="happy">Feliz</button>
                    <button class="emotion-btn" data-emotion="sad">Triste</button>
                    <button class="emotion-btn" data-emotion="surprised">Surpreso</button>
                    <button class="emotion-btn" data-emotion="angry">Bravo</button>
                    <button class="emotion-btn" data-emotion="curious">Curioso</button>
                </div>
            </div>

            <div class="control-group">
                <h3>‚öôÔ∏è Debug</h3>
                <button id="toggle-mesh" class="secondary">Mostrar Mesh</button>
            </div>

            <div class="log-container" id="log-container">
                <div class="log-entry">üé≠ Avatar Engine Pro v1.0</div>
                <div class="log-entry">üì° Aguardando inicializa√ß√£o...</div>
            </div>
        </div>
    </div>

    <script type="module">
        import { AvatarEnginePro } from './AvatarEnginePro.js';

        // Elementos UI
        const canvas = document.getElementById('lia-avatar');
        const imageInput = document.getElementById('image-input');
        const speakText = document.getElementById('speak-text');
        const speakBtn = document.getElementById('speak-btn');
        const stopBtn = document.getElementById('stop-btn');
        const toggleMeshBtn = document.getElementById('toggle-mesh');
        const statusDot = document.getElementById('status-dot');
        const statusText = document.getElementById('status-text');
        const logContainer = document.getElementById('log-container');
        const emotionButtons = document.querySelectorAll('.emotion-btn');

        // Engine
        let engine = null;

        // Log
        function log(message) {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        }

        // Update status
        function setStatus(text, active = false) {
            statusText.textContent = text;
            statusDot.className = 'status-dot' + (active ? ' active' : '');
        }

        // Inicializa√ß√£o
        async function init() {
            log('Inicializando engine...');
            engine = new AvatarEnginePro(canvas);

            engine.onSpeakStart = (text) => {
                log(`Falando: "${text.substring(0, 30)}..."`);
                setStatus('Falando...', true);
            };

            engine.onSpeakEnd = () => {
                log('Fala conclu√≠da');
                setStatus('Avatar pronto', true);
            };

            engine.onEmotionChange = (result) => {
                log(`Emo√ß√£o: ${result.emotion} (${(result.intensity * 100).toFixed(0)}%)`);
                updateEmotionButtons(result.emotion);
            };

            await engine.initialize();
            log('‚úÖ Engine inicializado');
        }

        // Carregar imagem
        imageInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            log(`Carregando imagem: ${file.name}`);
            setStatus('Carregando...', false);

            const img = new Image();
            img.src = URL.createObjectURL(file);

            img.onload = async () => {
                try {
                    await engine.createAvatar(img);
                    log('‚úÖ Avatar criado');
                    setStatus('Avatar pronto', true);
                    speakBtn.disabled = false;
                    stopBtn.disabled = false;
                } catch (err) {
                    log(`‚ùå Erro: ${err.message}`);
                    setStatus('Erro ao criar avatar', false);
                }
            };
        });

        // Falar
        speakBtn.addEventListener('click', async () => {
            const text = speakText.value.trim();
            if (!text) {
                log('Digite um texto');
                return;
            }

            speakBtn.disabled = true;
            await engine.speak(text, null);
            speakBtn.disabled = false;
        });

        // Parar
        stopBtn.addEventListener('click', () => {
            engine.stopSpeak();
            log('Fala interrompida');
        });

        // Toggle mesh
        toggleMeshBtn.addEventListener('click', () => {
            engine.config.renderDebugMesh = !engine.config.renderDebugMesh;
            toggleMeshBtn.textContent = engine.config.renderDebugMesh ? 'Ocultar Mesh' : 'Mostrar Mesh';
            log(`Debug mesh: ${engine.config.renderDebugMesh ? 'ON' : 'OFF'}`);
        });

        // Express√µes
        function updateEmotionButtons(emotion) {
            emotionButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.emotion === emotion);
            });
        }

        emotionButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const emotion = btn.dataset.emotion;
                engine.setExpression(emotion, 0.7);
                updateEmotionButtons(emotion);
                log(`Express√£o: ${emotion}`);
            });
        });

        // Enter para falar
        speakText.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !speakBtn.disabled) {
                speakBtn.click();
            }
        });

        // Iniciar
        init();
    </script>
</body>

</html>